<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script src="http://localhost:35729/livereload.js"></script>
    <title key="title"></title>
  <link href="./homework_9.css" rel="stylesheet"></head>
  <body>
    <div class="traffic-lighter">
      <div class="traffic-lighter__light traffic-lighter__light_red"></div>
      <div class="traffic-lighter__light traffic-lighter__light_yellow"></div>
      <div class="traffic-lighter__light traffic-lighter__light_green"></div>
      <button class="traffic-lighter__toggler">ON/OFF</button>
    </div>
  <script type="text/javascript" src="./homework_9.js"></script></body>
  <script>
    const trafficLighterRoot = document.querySelector(".traffic-lighter");
    const lights = trafficLighterRoot.querySelectorAll(
      ".traffic-lighter__light"
    );
    const togglerBtn = trafficLighterRoot.querySelector(
      ".traffic-lighter__toggler"
    );
    let isEnabled = false;
    let activeIndex = 0;
    let intervalId = 0;

    const toggleOffAll = () => {
      for (let i = 0; i < lights.length; i++) {
        lights[i].classList.remove("active");
      }
    };
    const activateLight = () => {
      lights[activeIndex].classList.add("active");
    };

    for (let i = 0; i < lights.length; i++) {
      lights[i].onclick = function() {
        if (isEnabled) {
          clearInterval(intervalId);
          toggleOffAll();
          activeIndex = i;
          activateLight();
          startAutoChange();
        }
      };
    }

    const changeIndex = () => {
      if (activeIndex + 1 < lights.length) {
        activeIndex += 1;
      } else {
        activeIndex = 0;
      }
    };

    const toggleOffLighter = () => {
      isEnabled = false;
      toggleOffAll();
      activeIndex = 0;
      clearInterval(intervalId);
    };
    const startAutoChange = () => {
      intervalId = setInterval(() => {
        toggleOffAll();
        changeIndex();
        activateLight();
      }, 1000);
    };
    const toggleOnLighter = () => {
      isEnabled = true;
      activateLight(0);
      startAutoChange();
    };

    const togglerClickHandler = () => {
      if (isEnabled) {
        toggleOffLighter();
      } else {
        toggleOnLighter();
      }
    };

    togglerBtn.onclick = togglerClickHandler;
  </script>
</html>
